// @flow
import type { UpdateOperation } from 'mongolike-operations'
import type { Id } from './id.js.flow'

export type EntityVersion = {
  id: Id,
  op: string, // stringified UpdateOperation
}

export type EntityMetaInfo = {
  versions: Array<EntityVersion>,
}


export type EntityWithMetaInfo = $Subtype<{
  id: Id,
  _PhenylMeta?: EntityMetaInfo
}>

export type VersionDiff = {|
  entityName: string,
  id: Id,
  prevVersionId: Id,
  versionId: Id,
  operation: UpdateOperation,
|}

export type SubscriptionRequest = {|
  method: 'subscribe',
  payload: {
    entityName: string,
    id: Id,
  },
  sessionId?: ?Id,
|}


export type SubscriptionResult = {|
  entityName: string,
  id: Id,
  result: boolean,
  ttl?: number,
|}

export type SubscriptionInfo = {|
  entityName: string,
  id: Id,
  ttl?: number,
|}

export type VersionDiffListener = (versionDiff: VersionDiff) => any

export interface VersionDiffSubscriber {
  subscribeVersionDiff(listener: VersionDiffListener): any
}

export interface VersionDiffPublisher {
  publishVersionDiff(versionDiff: VersionDiff): any
}
